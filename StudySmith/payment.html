<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Secure Payment Checkout | StudySmith</title>
<meta name="description" content="Complete your secure payment for StudySmith academic services. We support Bank Transfer, JazzCash, and EasyPaisa.">
<link rel="canonical" href="https://www.studysmith.online/payment.html">
<link rel="icon" href="assets/images/logo.jpg">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6252714666936335"
     crossorigin="anonymous"></script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "StudySmith",
  "url": "https://www.studysmith.online",
  "logo": "https://www.studysmith.online/assets/images/logo.jpg",
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "billing support",
    "telephone": "+92-326-4213612",
    "url": "https://wa.me/923264213612"
  }
}
</script>

<link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>

<div class="payment-box">
  <h1>Payment Information</h1>

  <h2>Order Summary</h2>
  <div class="summary" id="orderSummary"></div>

  <h2>Select Payment Method</h2>
  
  <form id="paymentForm" style="box-shadow:none; padding:0; max-width:none;">
    
    <div class="payment-group">
      <label class="payment-card">
        <img src="assets/images/bank-qr.jpeg" class="method-logo" alt="Bank">
        <span class="method-name">Bank Transfer</span>
        <input type="checkbox" class="pay pay-input" name="method_selection" value="Bank Transfer">
      </label>

      <label class="payment-card">
        <img src="assets/images/jazzcash.jpg" class="method-logo" alt="JazzCash">
        <span class="method-name">JazzCash</span>
        <input type="checkbox" class="pay pay-input" name="method_selection" value="JazzCash">
      </label>

      <label class="payment-card">
        <img src="assets/images/easypaisa.jpg" class="method-logo" alt="EasyPaisa">
        <span class="method-name">EasyPaisa</span>
        <input type="checkbox" class="pay pay-input" name="method_selection" value="EasyPaisa">
      </label>
    </div>

    <label class="terms-row">
      <input type="checkbox" id="agreeTerms">
      <span>I agree to the <a href="terms.html" target="_blank">Terms & Conditions</a> and <a href="privacy.html" target="_blank">Privacy Policy</a></span>
    </label>

    <button type="submit" class="submit-btn" id="payBtn" style="border-radius:50px;">Show Payment QR</button>
  </form>

  <div class="qr-section" id="qrSection">
    <h2>Scan to Pay</h2>
    <p id="qrText" style="color:var(--gray); font-size: 14px; margin-bottom: 15px;"></p>
    <img id="qrImage" alt="Payment QR">
    <br>
    <button class="whatsapp-btn submit-btn" id="whatsappBtn" style="border-radius:50px;">Submit Payment Proof</button>
  </div>
</div>

<footer>
  <p>© 2025 StudySmith — Crafting Student Success</p>
  <p><a href="index.html">Back to Home</a></p>
</footer>

<script>
// ==========================================
// GOOGLE FORMS CONFIGURATION (VERIFIED)
// ==========================================
const GOOGLE_PAY_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdju7tX606MBiv247u2wGRK3zkVQhvby_U_CVgoFmaWAN59Yw/formResponse'; 

const PAY_ENTRIES = {
    order_id:       'entry.733458012', 
    plan_name:      'entry.496293268',
    amount:         'entry.46699115',
    payment_method: 'entry.1235272844'
};
// ==========================================

// ============================================
// 1. LOAD & DISPLAY ORDER DATA
// ============================================
const urlParams = new URLSearchParams(window.location.search);
const paramPlan = urlParams.get('plan');
const paramPrice = urlParams.get('price');

let orderID, totalPrice, orderStatus, planName;

// SCENARIO A: User clicked a plan on Pricing Page
if (paramPlan && paramPrice) {
  orderID = "DIR-" + Math.floor(1000 + Math.random() * 9000); 
  totalPrice = paramPrice;
  orderStatus = "Ready for Payment";
  planName = paramPlan;
} 
// SCENARIO B: User filled out the Request Form
else {
  orderID = localStorage.getItem('orderID');
  totalPrice = localStorage.getItem('total_price') || "0";
  orderStatus = localStorage.getItem('orderStatus') || "Pending Payment";
  planName = "Custom Service Request"; 
}

// Render Summary
const orderDiv = document.getElementById('orderSummary');
if(!orderID){
  orderDiv.innerHTML = "<p style='color:red'>No order found. Please submit a request or select a plan first.</p>";
} else {
  orderDiv.innerHTML = `
    <p><strong>Order ID:</strong> ${orderID}</p>
    <p><strong>Plan:</strong> ${planName}</p>
    <p><strong>Status:</strong> ${orderStatus}</p>
    <p style="font-size: 1.2em; color: var(--navy);"><strong>Total Amount:</strong> ${totalPrice} PKR</p>
  `;
}

// ============================================
// 2. PAYMENT METHODS & UI LOGIC
// ============================================
const qrCodes = {
  "Bank Transfer": { img: "assets/images/bank-qr.jpeg", text: "Bank Transfer - Scan QR to pay via your bank app" },
  "JazzCash": { img: "assets/images/jazzcash-qr.jpg", text: "JazzCash - Scan QR to pay via JazzCash app" },
  "EasyPaisa": { img: "assets/images/easypaisa-qr.jpeg", text: "EasyPaisa - Scan QR to pay via EasyPaisa app" }
};

const boxes = document.querySelectorAll('.pay');
boxes.forEach(b => {
  b.addEventListener('change', () => {
    if(b.checked){
      boxes.forEach(x => x !== b && (x.checked = false));
    }
  });
});

// ============================================
// 3. FORM SUBMISSION (GOOGLE SHEETS + QR SHOW)
// ============================================
const paymentForm = document.getElementById('paymentForm');
const payBtn = document.getElementById('payBtn');
const qrSection = document.getElementById('qrSection');
const qrImage = document.getElementById('qrImage');
const qrText = document.getElementById('qrText');
const whatsappBtn = document.getElementById('whatsappBtn');
const agreeTerms = document.getElementById('agreeTerms');

paymentForm.addEventListener('submit', e => {
  e.preventDefault(); 

  const selected = document.querySelector('.pay:checked');
  
  if(!selected){
    alert("Please select a payment method");
    return;
  }
  if(!agreeTerms.checked){
    alert("You must agree to Terms & Conditions");
    return;
  }

  // Disable button to prevent double clicks
  payBtn.disabled = true;
  payBtn.textContent = "Processing...";

  // A. Prepare Data for Google
  const formData = new FormData();
  formData.append(PAY_ENTRIES.order_id, orderID);
  formData.append(PAY_ENTRIES.plan_name, planName);
  formData.append(PAY_ENTRIES.amount, totalPrice);
  formData.append(PAY_ENTRIES.payment_method, selected.value);

  // B. Send to Google (Background Fetch)
  fetch(GOOGLE_PAY_URL, {
    method: 'POST',
    mode: 'no-cors',
    body: formData
  }).then(() => {
    console.log("Google Form submitted successfully");
  }).catch(err => {
    console.error("Google Form Error:", err);
  }).finally(() => {
    // C. Show QR Code
    const method = qrCodes[selected.value];
    qrImage.src = method.img;
    qrText.textContent = method.text;
    qrSection.style.display = 'block';
    whatsappBtn.style.display = 'inline-block';
    qrSection.scrollIntoView({ behavior: 'smooth' });
    
    payBtn.textContent = "Show Payment QR";
    payBtn.disabled = false;
  });
});

// ============================================
// 4. WHATSAPP BUTTON LOGIC
// ============================================
whatsappBtn.addEventListener('click', () => {
  const msg = `Hello StudySmith,
I have completed my payment.

Order ID: ${orderID}
Plan: ${planName}
Total Paid: ${totalPrice} PKR

Please find the payment screenshot attached.`;

  window.open(
    "https://wa.me/923264213612?text=" + encodeURIComponent(msg),
    "_blank"
  );
});
</script>

</body>
</html>
