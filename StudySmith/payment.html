<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Secure Payment Checkout | StudySmith</title>
<meta name="description" content="Complete your secure payment for StudySmith academic services. We support Bank Transfer, JazzCash, and EasyPaisa.">
<link rel="canonical" href="https://www.studysmith.online/payment.html">
<link rel="icon" href="assets/images/logo.jpg">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6252714666936335"
     crossorigin="anonymous"></script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "StudySmith",
  "url": "https://www.studysmith.online",
  "logo": "https://www.studysmith.online/assets/images/logo.jpg",
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "billing support",
    "telephone": "+92-326-4213612",
    "url": "https://wa.me/923264213612"
  }
}
</script>

<link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>

<div class="payment-box">
  <h1>Payment Information</h1>

  <h2>Order Summary</h2>
  <div class="summary" id="orderSummary"></div>

  <h2>Select Payment Method</h2>
  
  <form id="paymentForm" name="payment_attempt" method="POST" data-netlify="true" style="box-shadow:none; padding:0; max-width:none;">
    
    <input type="hidden" name="form-name" value="payment_attempt">
    <input type="hidden" name="Order_ID" id="hiddenOrderID">
    <input type="hidden" name="Plan_Name" id="hiddenPlan">
    <input type="hidden" name="Amount" id="hiddenAmount">
    <input type="hidden" name="Payment_Method" id="hiddenMethod">

    <div class="payment-group">
      
      <label class="payment-card">
        <img src="assets/images/bank-qr.jpeg" class="method-logo" alt="Bank">
        <span class="method-name">Bank Transfer</span>
        <input type="checkbox" class="pay pay-input" name="method_selection" value="bank">
      </label>

      <label class="payment-card">
        <img src="assets/images/jazzcash.jpg" class="method-logo" alt="JazzCash">
        <span class="method-name">JazzCash</span>
        <input type="checkbox" class="pay pay-input" name="method_selection" value="jazzcash">
      </label>

      <label class="payment-card">
        <img src="assets/images/easypaisa.jpg" class="method-logo" alt="EasyPaisa">
        <span class="method-name">EasyPaisa</span>
        <input type="checkbox" class="pay pay-input" name="method_selection" value="easypaisa">
      </label>

    </div>

    <label class="terms-row">
      <input type="checkbox" id="agreeTerms">
      <span>I agree to the <a href="terms.html" target="_blank">Terms & Conditions</a> and <a href="privacy.html" target="_blank">Privacy Policy</a></span>
    </label>

    <button type="submit" class="submit-btn" style="border-radius:50px;">Show Payment QR</button>
  </form>

  <div class="qr-section" id="qrSection">
    <h2>Scan to Pay</h2>
    <p id="qrText" style="color:var(--gray); font-size: 14px; margin-bottom: 15px;"></p>
    <img id="qrImage" alt="Payment QR">
    <br>
    <button class="whatsapp-btn submit-btn" id="whatsappBtn" style="border-radius:50px;">Submit Payment Proof</button>
  </div>
</div>

<footer>
  <p>© 2025 StudySmith — Crafting Student Success</p>
  <p><a href="index.html">Back to Home</a></p>
</footer>

<script>
// ============================================
// 1. LOAD & DISPLAY ORDER DATA
// ============================================
const urlParams = new URLSearchParams(window.location.search);
const paramPlan = urlParams.get('plan');
const paramPrice = urlParams.get('price');

let orderID, totalPrice, orderStatus, planName;

// SCENARIO A: User clicked a plan on Pricing Page (Direct Link)
if (paramPlan && paramPrice) {
  orderID = "DIR-" + Math.floor(1000 + Math.random() * 9000); 
  totalPrice = paramPrice;
  orderStatus = "Ready for Payment";
  planName = paramPlan;
} 
// SCENARIO B: User filled out the Request Form (LocalStorage)
else {
  orderID = localStorage.getItem('orderID');
  totalPrice = localStorage.getItem('total_price') || "0";
  orderStatus = localStorage.getItem('orderStatus') || "Pending Payment";
  planName = "Custom Service Request"; 
}

// Render Summary
const orderDiv = document.getElementById('orderSummary');
if(!orderID){
  orderDiv.innerHTML = "<p style='color:red'>No order found. Please submit a request or select a plan first.</p>";
} else {
  orderDiv.innerHTML = `
    <p><strong>Order ID:</strong> ${orderID}</p>
    <p><strong>Plan:</strong> ${planName}</p>
    <p><strong>Status:</strong> ${orderStatus}</p>
    <p style="font-size: 1.2em; color: var(--navy);"><strong>Total Amount:</strong> ${totalPrice} PKR</p>
  `;
}

// ============================================
// 2. PAYMENT METHODS & UI LOGIC
// ============================================
const qrCodes = {
  bank: { img: "assets/images/bank-qr.jpeg", text: "Bank Transfer - Scan QR to pay via your bank app" },
  jazzcash: { img: "assets/images/jazzcash-qr.jpg", text: "JazzCash - Scan QR to pay via JazzCash app" },
  easypaisa: { img: "assets/images/easypaisa-qr.jpeg", text: "EasyPaisa - Scan QR to pay via EasyPaisa app" }
};

// Ensure only one checkbox is selected at a time
const boxes = document.querySelectorAll('.pay');
boxes.forEach(b => {
  b.addEventListener('change', () => {
    if(b.checked){
      boxes.forEach(x => x !== b && (x.checked = false));
    }
  });
});

// ============================================
// 3. FORM SUBMISSION (NETLIFY + QR SHOW)
// ============================================
const paymentForm = document.getElementById('paymentForm');
const qrSection = document.getElementById('qrSection');
const qrImage = document.getElementById('qrImage');
const qrText = document.getElementById('qrText');
const whatsappBtn = document.getElementById('whatsappBtn');
const agreeTerms = document.getElementById('agreeTerms');

// Hidden Input References
const hiddenOrderID = document.getElementById('hiddenOrderID');
const hiddenPlan = document.getElementById('hiddenPlan');
const hiddenAmount = document.getElementById('hiddenAmount');
const hiddenMethod = document.getElementById('hiddenMethod');

paymentForm.addEventListener('submit', e => {
  e.preventDefault(); // Stop page reload

  const selected = document.querySelector('.pay:checked');
  
  // Validation
  if(!selected){
    alert("Please select a payment method");
    return;
  }
  if(!agreeTerms.checked){
    alert("You must agree to Terms & Conditions");
    return;
  }

  // A. Populate Hidden Inputs for Netlify
  hiddenOrderID.value = orderID;
  hiddenPlan.value = planName;
  hiddenAmount.value = totalPrice;
  hiddenMethod.value = selected.value;

  // B. Show QR Code (Immediate UI Feedback)
  const method = qrCodes[selected.value];
  qrImage.src = method.img;
  qrText.textContent = method.text;
  qrSection.style.display = 'block';
  whatsappBtn.style.display = 'inline-block';
  qrSection.scrollIntoView({ behavior: 'smooth' });

  // C. Send Data to Netlify (Background Fetch)
  const myFormData = new FormData(paymentForm);
  
  fetch("/", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(myFormData).toString()
  })
  .then(() => console.log("Netlify notification sent successfully"))
  .catch(error => console.error("Notification failed", error));
});

// ============================================
// 4. WHATSAPP BUTTON LOGIC
// ============================================
whatsappBtn.addEventListener('click', () => {
  const msg = `Hello StudySmith,
I have completed my payment.

Order ID: ${orderID}
Plan: ${planName}
Total Paid: ${totalPrice} PKR

Please find the payment screenshot attached.`;

  window.open(
    "https://wa.me/923264213612?text=" + encodeURIComponent(msg),
    "_blank"
  );
});
</script>

</body>
</html>
